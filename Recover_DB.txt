#!/bin/bash

#Preconditions:

#Create database:

echo "Enter name of database:"
read dbname

mysql -uroot -p -e "CREATE DATABASE IF NOT EXISTS $dbname;
	USE $dbname;
	CREATE TABLE IF NOT EXISTS Parrots (Name varchar(20), Gender char(1), Colour varchar (20));
	REPLACE INTO Parrots (Name,Gender,Colour) VALUES('Kiesha', 'M', 'Green');
	REPLACE INTO Parrots (Name,Gender,Colour) VALUES('Chica', 'W', 'Blue');"

echo "Preconditions:"
echo "DATABASE $dbname with TABLE Parrots was created"

#Make backup of $dbname:

echo "Creating backup of database"
Curdate=$(date +%Y-%m-%d-%H)

if [ -d "/home/MySQL_backup/$Curdate" ]
then
	rm -rf $Curdate
fi
	
mkdir -p /home/MySQL_backup/$Curdate
mysqldump -uroot -p $dbname > "/home/MySQL_backup/$Curdate/$dbname.sql"
echo "Backup of $dbname created"
mysql -uroot -p -e "DROP DATABASE $dbname; CREATE DATABASE $dbname;"
echo "$dbname is deleted"
mysql -uroot -p -e "Show databases;"
echo "Preconditions prepared"

echo "Restore $dbname from backup"
mysql -uroot -p $dbname < "/home/MySQL_backup/$Curdate/$dbname.sql"

if [ $? -eq 0 ]; then
    $SETCOLOR_SUCCESS
    echo -n "$(tput hpa $(tput cub 6))$(tput cub 6)[OK]"
    $SETCOLOR_NORMAL
    echo -e "\nDATABASE $dbname restored"
else
    $SETCOLOR_FAILURE
    echo -n "$(tput hpa $(tput cub 6))$(tput cub 6)[fail]"
    $SETCOLOR_NORMAL
    echo -e "\nDATABASE $dbname restored"
fi